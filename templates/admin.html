<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="../static/plot.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> <!-- jQuery for optional JS -->
    <script>
        $(document).ready(function() {
    // Add fade-in animation to table rows on page load
    $('tr').addClass('fadeInRow');

    // Example: Handle delete button click
    $('.delete-btn').click(function() {
        var rowIndex = $(this).data('index'); // Get the row index from data attribute

        var confirmation = confirm("Are you sure you want to delete this ticket?");
        if (confirmation) {
            // Perform AJAX request or form submission to delete the ticket
            var data = {
                index: rowIndex,
                passcode: '984228'  // Replace with actual passcode or fetch dynamically
            };

            $.ajax({
                type: "POST",
                url: "/delete_ticket",
                data: data,
                success: function(response) {
                    alert('Ticket deleted successfully!');
                    location.reload(); // Refresh the page after deletion
                },
                error: function(error) {
                    console.error('Error deleting ticket:', error);
                    alert('Failed to delete ticket. Please try again.');
                }
            });
        }
    });

    // Example: Handle update button click
    $('.update-btn').click(function() {
        var rowIndex = $(this).closest('tr').index() + 1; // Get the row index (1-based)

        // Example: Redirect to update form or open modal for updating ticket details
        window.location.href = "/update_ticket?index=" + rowIndex;
    });
});

    </script> <!-- Custom JavaScript -->
</head>
<body>
    <div class="container">
        <h1>Admin Dashboard</h1>

        <section class="chart-container">
            <h2>Total Tickets Overview</h2>
            <img src="{{ pie_chart }}" alt="Pie Chart">
        </section>

        <section>
            <h2>All Tickets</h2>
            <table id="ticket-table">
                <thead>
                    <tr>
                        <th>Employee Name</th>
                        <th>Employee ID</th>
                        <th>Issue</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>IT Support</th>
                        <th>Resolution</th>
                        <th>Status</th>
                        <th>Actions</th> <!-- New column for actions -->
                    </tr>
                </thead>
                <tbody>
                    {% for row in rows %}
                    <tr>
                        <td>{{ row[0] }}</td>
                        <td>{{ row[1] }}</td>
                        <td>{{ row[2] }}</td>
                        <td>{{ row[3] }}</td>
                        <td>{{ row[4] }}</td>
                        <td>{{ row[5] }}</td>
                        <td>{{ row[6] }}</td>
                        <td>{{ row[7] }}</td>
                        <td>
                            <!-- Delete button -->
                            <button class="delete-btn" data-index="{{ loop.index }}">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
    </div>
</body>
</html>
